<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Wiretap.Maui.UI.WiretapDetailPage"
             Title="Request Details"
             BackgroundColor="{AppThemeBinding Light={StaticResource White}, Dark={StaticResource Black}}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="cURL" Clicked="OnCopyCurlClicked" />
        <ToolbarItem Text="PDF" Clicked="OnExportPdfClicked" />
    </ContentPage.ToolbarItems>

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="SectionHeaderStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#333333, Dark=#CCCCCC}" />
                <Setter Property="Margin" Value="0,15,0,8" />
            </Style>
            <Style x:Key="MonospaceStyle" TargetType="Label">
                <Setter Property="FontFamily" Value="Courier New" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#444444, Dark=#BBBBBB}" />
            </Style>
            <Style x:Key="CodeEditorStyle" TargetType="Editor">
                <Setter Property="FontFamily" Value="Courier New" />
                <Setter Property="FontSize" Value="12" />
                <Setter Property="IsReadOnly" Value="True" />
                <Setter Property="AutoSize" Value="Disabled" />
                <Setter Property="HeightRequest" Value="300" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#F8F8F8, Dark=#1E1E1E}" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#333333, Dark=#D4D4D4}" />
            </Style>
            <Style x:Key="CopyButtonStyle" TargetType="Button">
                <Setter Property="FontSize" Value="12" />
                <Setter Property="Padding" Value="10,5" />
                <Setter Property="BackgroundColor" Value="{AppThemeBinding Light=#E0E0E0, Dark=#3D3D3D}" />
                <Setter Property="TextColor" Value="{AppThemeBinding Light=#333333, Dark=#CCCCCC}" />
                <Setter Property="CornerRadius" Value="4" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,Auto,*">

        <!-- Summary Header -->
        <Border Grid.Row="0"
                Padding="15"
                BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#1E1E1E}">
            <VerticalStackLayout Spacing="8">
                <HorizontalStackLayout Spacing="10">
                    <!-- Method Badge -->
                    <Border x:Name="MethodBadge"
                            Padding="10,5"
                            BackgroundColor="#2196F3">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="4" />
                        </Border.StrokeShape>
                        <Label x:Name="MethodLabel"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="White" />
                    </Border>

                    <!-- Status Badge -->
                    <Border x:Name="StatusBadge"
                            Padding="10,5"
                            BackgroundColor="#4CAF50"
                            IsVisible="True">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="4" />
                        </Border.StrokeShape>
                        <Label x:Name="StatusLabel"
                               FontSize="13"
                               FontAttributes="Bold"
                               TextColor="White" />
                    </Border>

                    <!-- Error indicator -->
                    <Label x:Name="ErrorIndicator"
                           Text="⚠️ Failed"
                           FontSize="13"
                           TextColor="#F44336"
                           VerticalOptions="Center"
                           IsVisible="False" />
                </HorizontalStackLayout>

                <Label x:Name="UrlLabel"
                       FontSize="13"
                       LineBreakMode="CharacterWrap"
                       MaxLines="3" />

                <HorizontalStackLayout Spacing="20">
                    <Label x:Name="TimestampLabel"
                           FontSize="12"
                           TextColor="Gray" />
                    <Label x:Name="DurationLabel"
                           FontSize="12"
                           TextColor="Gray" />
                    <Label x:Name="SizeLabel"
                           FontSize="12"
                           TextColor="Gray" />
                </HorizontalStackLayout>

                <Label x:Name="ErrorMessageLabel"
                       FontSize="12"
                       TextColor="#F44336"
                       IsVisible="False"
                       LineBreakMode="WordWrap" />
            </VerticalStackLayout>
        </Border>

        <!-- Tab Selector -->
        <Grid Grid.Row="1"
              ColumnDefinitions="*,*"
              Padding="15,10"
              ColumnSpacing="10">
            <Button x:Name="RequestTabButton"
                    Text="Request"
                    Clicked="OnRequestTabClicked"
                    BackgroundColor="{AppThemeBinding Light=#2196F3, Dark=#1976D2}"
                    TextColor="White"
                    CornerRadius="4" />
            <Button x:Name="ResponseTabButton"
                    Grid.Column="1"
                    Text="Response"
                    Clicked="OnResponseTabClicked"
                    BackgroundColor="{AppThemeBinding Light=#E0E0E0, Dark=#3D3D3D}"
                    TextColor="{AppThemeBinding Light=#666666, Dark=#AAAAAA}"
                    CornerRadius="4" />
        </Grid>

        <!-- Content Area -->
        <ScrollView Grid.Row="2" Padding="15,0,15,15">
            <Grid>
                <!-- Request Content -->
                <VerticalStackLayout x:Name="RequestContent" Spacing="5">

                    <!-- Request Headers Section -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Headers" Style="{StaticResource SectionHeaderStyle}" />
                        <Button Grid.Column="1"
                                Text="Copy"
                                Style="{StaticResource CopyButtonStyle}"
                                Clicked="OnCopyRequestHeadersClicked" />
                    </Grid>
                    <Border Padding="10"
                            BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#1E1E1E}"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6" />
                        </Border.StrokeShape>
                        <Label x:Name="RequestHeadersLabel"
                               Style="{StaticResource MonospaceStyle}" />
                    </Border>

                    <!-- Request Body Section -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Body" Style="{StaticResource SectionHeaderStyle}" />
                        <Button Grid.Column="1"
                                Text="Copy"
                                Style="{StaticResource CopyButtonStyle}"
                                Clicked="OnCopyRequestBodyClicked" />
                    </Grid>
                    <Border Padding="10"
                            BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#1E1E1E}"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6" />
                        </Border.StrokeShape>
                        <Editor x:Name="RequestBodyEditor" Style="{StaticResource CodeEditorStyle}" />
                    </Border>

                    <Label x:Name="RequestTruncatedLabel"
                           Text="⚠️ Body was truncated due to size limits"
                           FontSize="11"
                           TextColor="#FF9800"
                           IsVisible="False"
                           Margin="0,5,0,0" />
                </VerticalStackLayout>

                <!-- Response Content -->
                <VerticalStackLayout x:Name="ResponseContent" Spacing="5" IsVisible="False">

                    <!-- Response Headers Section -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Headers" Style="{StaticResource SectionHeaderStyle}" />
                        <Button Grid.Column="1"
                                Text="Copy"
                                Style="{StaticResource CopyButtonStyle}"
                                Clicked="OnCopyResponseHeadersClicked" />
                    </Grid>
                    <Border Padding="10"
                            BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#1E1E1E}"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6" />
                        </Border.StrokeShape>
                        <Label x:Name="ResponseHeadersLabel"
                               Style="{StaticResource MonospaceStyle}" />
                    </Border>

                    <!-- Response Body Section -->
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="Body" Style="{StaticResource SectionHeaderStyle}" />
                        <Button Grid.Column="1"
                                Text="Copy"
                                Style="{StaticResource CopyButtonStyle}"
                                Clicked="OnCopyResponseBodyClicked" />
                    </Grid>
                    <Border Padding="10"
                            BackgroundColor="{AppThemeBinding Light=#F8F8F8, Dark=#1E1E1E}"
                            StrokeThickness="1"
                            Stroke="{AppThemeBinding Light=#E0E0E0, Dark=#333333}">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="6" />
                        </Border.StrokeShape>
                        <Editor x:Name="ResponseBodyEditor" Style="{StaticResource CodeEditorStyle}" />
                    </Border>

                    <Label x:Name="ResponseTruncatedLabel"
                           Text="⚠️ Body was truncated due to size limits"
                           FontSize="11"
                           TextColor="#FF9800"
                           IsVisible="False"
                           Margin="0,5,0,0" />
                </VerticalStackLayout>
            </Grid>
        </ScrollView>
    </Grid>
</ContentPage>
